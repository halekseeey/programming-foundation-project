{% extends "base.html" %}

{% block content %}
<main class="px-6 py-8 max-w-[900px] mx-auto space-y-10">
    <header class="gap-4 flex justify-between">
        <div class="flex flex-col gap-2">
            <h1 class="text-3xl font-bold tracking-tight">EU Renewable Energy Explorer</h1>
            <p class="text-sm text-slate-400">
                Flask + Python analytics (pandas, numpy, matplotlib, seaborn, plotly) with Flask Web App.
            </p>
        </div>
    </header>

    <section class="bg-slate-900/60 border border-slate-800 rounded-2xl p-4 space-y-4">
        <div class="flex items-start justify-between gap-4">
            <div class="flex-1 space-y-3">
                <h3 class="text-sm font-semibold text-white">Dataset Merge Information</h3>

                <div class="text-xs text-slate-300 space-y-3">
                    <div>
                        <p class="font-semibold text-slate-200 mb-1">Merged Dataset Concept:</p>
                        <p>
                            For each <code class="bg-slate-800 px-1 rounded">country + year</code> combination, we
                            combine two metrics in a single row:
                        </p>
                    </div>

                    <div class="bg-slate-800/40 rounded-lg p-3 space-y-2">
                        <div>
                            <p class="font-semibold text-sky-300 mb-1">
                                <code class="bg-slate-700 px-1 rounded">OBS_VALUE_nrg_bal</code> — Primary Energy
                                Production
                            </p>
                            <p class="text-slate-400 ml-2">
                                From the <code class="bg-slate-700 px-1 rounded">nrg_bal</code> dataset, we use only
                                the "Primary production" category with "Total" aggregation (sum across
                                all energy sources). Unit: Terajoule.
                            </p>
                        </div>

                        <div>
                            <p class="font-semibold text-green-300 mb-1">
                                <code class="bg-slate-700 px-1 rounded">OBS_VALUE_nrg_ind_ren</code> — Renewable
                                Energy Percentage
                            </p>
                            <p class="text-slate-400 ml-2">
                                From the <code class="bg-slate-700 px-1 rounded">nrg_ind_ren</code> dataset, we take
                                the renewable energy percentage of total production. Unit: percentage (%).
                            </p>
                        </div>
                    </div>

                    <div>
                        <p class="font-semibold text-slate-200 mb-1">Purpose:</p>
                        <p>
                            This allows analyzing correlations between primary energy production volume and the share of
                            renewable sources. For example, you can see if the renewable energy share grows with
                            increasing total production, or vice versa.
                        </p>
                    </div>

                    <div class="text-slate-400 italic">
                        <p>
                            <strong>Note:</strong> Empty values (NaN) indicate that data is missing for that country-year
                            combination in the corresponding dataset.
                        </p>
                    </div>
                </div>
            </div>
            <div class="flex-shrink-0">
                <button
                    id="load-preview-btn"
                    class="px-4 py-2 bg-sky-600 hover:bg-sky-700 text-white text-sm font-semibold rounded-lg transition-colors"
                >
                    Load Preview
                </button>
            </div>
        </div>
    </section>

    <!-- Loading State -->
    <section id="loading-section" class="bg-slate-900/60 border border-slate-800 rounded-2xl p-6 space-y-4">
        <div class="flex items-center justify-center py-4">
            <div class="text-center space-y-2">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-sky-500"></div>
                <p class="text-sm text-slate-400">Loading analysis data...</p>
            </div>
        </div>
    </section>

    <!-- Dashboard Section -->
    <section id="dashboard-container" class="space-y-6"></section>

    <!-- Analysis Section -->
    <section id="analysis-section" class="space-y-6" style="display: none;">
        <h2 class="text-2xl font-bold tracking-tight">Data Analysis</h2>

        <div class="space-y-6">
            <!-- Global Trends -->
            <div id="global-trends-container"></div>

            <!-- Energy Sources Comparison -->
            <div id="energy-sources-container"></div>

            <!-- Regions Ranking -->
            <div id="regions-ranking-container"></div>

            <!-- Correlation Analysis -->
            <div id="correlation-analysis-container"></div>

            <!-- Additional Visualizations -->
            <div id="additional-visualizations-container"></div>
        </div>
    </section>

    <!-- Filters and Filtered Analysis Section -->
    <section class="space-y-6">
        <h2 class="text-2xl font-bold tracking-tight">Interactive Exploration</h2>
        <p class="text-sm text-slate-400">
            Select a region or energy type to explore detailed analysis and trends.
        </p>
        
        <!-- Filters Section -->
        <div id="filters-container" class="space-y-6"></div>
        
        <!-- Filtered Analysis Results -->
        <div id="filtered-analysis-container" class="space-y-6" style="display: none;">
            <h3 class="text-xl font-semibold">Filtered Analysis Results</h3>
            <div id="filtered-charts-container" class="space-y-6"></div>
        </div>
    </section>
</main>

<!-- Dataset Preview Modal -->
<div
    id="dataset-preview-modal"
    class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden items-center justify-center"
    style="display: none;"
>
    <div class="bg-slate-900 border border-slate-800 rounded-2xl p-6 max-w-5xl w-full mx-4 max-h-[90vh] flex flex-col">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-semibold">Dataset Preview: Merged Dataset</h2>
            <button
                id="close-preview-modal-btn"
                class="text-slate-400 hover:text-white transition-colors"
                aria-label="Close"
            >
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <path d="M18 6L6 18" />
                    <path d="M6 6l12 12" />
                </svg>
            </button>
        </div>
        <div id="dataset-preview-container" class="flex-1 overflow-auto"></div>
    </div>
</div>
{% endblock %}

